@model WebApp.Models.AccountRegistrationModel
@{
    Layout = null;
}

<!DOCTYPE html>
<!--
Template Name:  SmartAdmin Responsive WebApp - Template build with Twitter Bootstrap 4
Version: 4.4.1
Author: Sunnyat Ahmmed
Website: http://gootbootstrap.com
Purchase: https://wrapbootstrap.com/theme/smartadmin-responsive-webapp-WB0573SK0
License: You must have a valid license purchased only from wrapbootstrap.com (link above) in order to legally use this theme for your project.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>
    @ViewBag.AppName
  </title>
  <meta name="description" content="Login">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, minimal-ui">
  <!-- Call App Mode on ios devices -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- Remove Tap Highlight on Windows Phone IE -->
  <meta name="msapplication-tap-highlight" content="no">
  <!-- base css -->
  <link rel="stylesheet" media="screen, print" href="~/Content/css/vendors.bundle.css">
  <link rel="stylesheet" media="screen, print" href="~/Content/css/app.bundle.css">
  <!-- Place favicon.ico in the root directory -->
  <link rel="apple-touch-icon" sizes="180x180" href="~/Content/img/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="~/Content/img/favicon/favicon-32x32.png">
  <link rel="mask-icon" href="~/Content/img/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <!-- Optional: page related CSS-->
  <link href="~/Content/css/site.css" rel="stylesheet" />
  <link rel="stylesheet" media="screen, print" href="~/Content/css/fa-brands.css">
  <link href="~/Content/css/formplugins/cropperjs/cropper.css" rel="stylesheet" />
  <style>
    .overlay {
      position: absolute;
      bottom: 10px;
      left: 0;
      right: 0;
      background-color: rgba(255, 255, 255, 0.5);
      overflow: hidden;
      height: 0;
      transition: .5s ease;
      width: 100%;
    }

    .avatars:hover .overlay {
      height: 50%;
      cursor: pointer;
    }

    .avatars {
      position: relative;
      border-radius: 50%;
    }

    .text {
      color: #333;
      position: absolute;
      top: 30%;
      left: 50%;
      -webkit-transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      text-align: center;
    }

    img {
      display: block !important;
      /* This rule is very important, please don't ignore this */
      max-width: 100%;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="page-inner bg-brand-gradient">
      <div class="page-content-wrapper bg-transparent m-0">
        <div class="height-10 w-100 shadow-lg px-4 bg-brand-gradient">
          <div class="d-flex align-items-center container p-0">
            <div class="page-logo width-mobile-auto m-0 align-items-center justify-content-center p-0 bg-transparent bg-img-none shadow-0 height-9">
              <a href="javascript:void(0)" class="page-logo-link press-scale-down d-flex align-items-center">
                <img src="~/Content/img/logo.png" alt="@ViewBag.AppName" aria-roledescription="logo">
                <span class="page-logo-text mr-1">@ViewBag.AppName</span>
              </a>
            </div>
            <span class="text-white opacity-50 ml-auto mr-2 hidden-sm-down">
              已经有账号?
            </span>
            <a href="@Url.Action("login", "account")" class="btn-link text-white ml-auto ml-sm-0">
              登录
            </a>
          </div>
        </div>
        <div class="flex-1" style="background: url(/Content/img/svg/pattern-1.svg) no-repeat center bottom fixed; background-size: cover;">
          <div class="container py-4 py-lg-5 my-lg-5 px-4 px-sm-0">
            <div class="row">
              <div class="col-xl-12">
                <h2 class="fs-xxl fw-500 mt-4 text-white text-center">
                  注册新账号
                  <small class="h3 fw-300 mt-3 mb-5 text-white opacity-60 hidden-sm-down">

                  </small>
                </h2>
              </div>
              <div class="col-xl-6 ml-auto mr-auto">
                <div class="card p-4 rounded-plus bg-faded">
                  <form id="js-register" novalidate="" action="/Account/Register" method="post">
                    @Html.ValidationBootstrap()
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(model => model.Avatars)
            
                    <div class="row no-gutters row-grid">
                      <div class="col-12">
                        <div class="d-flex flex-column align-items-center justify-content-center pb-4">
                          <div class="avatars">
                            <img id="avatar_lg" src="@Fingerprint.Tag("/Content/img/avatars/" + Model.Avatars)"
                                 style="width:129.5px"
                                 class="rounded-circle shadow-2 img-thumbnail" alt="">

                            <div class="overlay">
                              <div class="text">
                                <h5 class="mb-0 fw-700 text-center mt-3">
                                  单击修改照片
                                </h5>
                              </div>
                            </div>
                            <input type="file" name="upload_avatar" class="image" id="upload_avatar" style="display:none" />
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-md-6">
                        <label class="form-label" for="newusername">登录用户名</label>
                        <input type="text" class="form-control" id="Username" name="Username" required>
                        <div class="invalid-feedback">
                          请输入用户名
                        </div>
                      </div>
                      <div class="col-md-6">

                        <label class="form-label" for="givenName">中文名</label>
                        <input type="text" class="form-control" id="GivenName" name="GivenName" required>
                        <div class="invalid-feedback">
                          请输入用户名
                        </div>

                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-md-6">
                        <label class="form-label" for="newpassword">新密码</label>
                        <input type="password" class="form-control" id="Password" name="Password" required minlength="4">
                        <div class="invalid-feedback">
                          请输入新密码
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label" for="newpasswordConfirm">再输入新密码</label>
                        <input type="password" class="form-control" id="PasswordConfirm" name="PasswordConfirm" required minlength="4">
                        <div class="invalid-feedback">
                          请输入正确的密码
                        </div>
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-md-6">
                        <label class="form-label" for="newemail">邮件地址</label>
                        <input type="email" class="form-control" id="Email" name="Email" required>
                        <div class="invalid-feedback">
                          请输入邮件地址
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label" for="phonenumber">联系电话</label>
                        <input type="number" class="form-control" id="PhoneNumber" name="PhoneNumber">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="tenantid">租户</label>
                      @Html.DropDownList("TenantId", (IEnumerable
                <SelectListItem>)ViewBag.TenantId, new { @class = "form-control", required = "required" })

                      <div class="invalid-feedback">
                        请选择租户
                      </div>
                    </div>

                    <div class="form-group demo">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="terms" required>
                        <label class="custom-control-label" for="terms"> I agree to terms & conditions</label>
                        <div class="invalid-feedback">You must agree before proceeding</div>
                      </div>

                    </div>
                    <div class="row no-gutters">
                      <div class="col-md-4 ml-auto text-right">
                        <button id="js-register-btn" type="submit" class="btn btn-block btn-danger btn-lg mt-3">注册</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <div class="position-absolute pos-bottom pos-left pos-right p-3 text-center text-white">
            @Html.Raw(ViewBag.Copyright)
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade copper-modal-right" tabindex="-1" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-dialog modal-dialog-right  ">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title h4">修改照片</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true"><i class="fal fa-times"></i></span>
          </button>
        </div>
        <div class="modal-body">
          <div class="panel-container show">
            <div class="panel-content">
              <div class="row">
                <div class="col-12">
                  <div class="img-container">

                    <img id="upload_avatar_image" />
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div class="card mb-g">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-12">
                  <div class="docs-preview clearfix">
                    <div class="img-preview preview-lg"></div>
                    <div class="img-preview preview-md"></div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary waves-effect waves-themed" data-dismiss="modal">Close</button>
          <button type="button" id="getcoppedbutton" class="btn btn-primary waves-effect waves-themed">确认</button>
        </div>
      </div>
    </div>
  </div>
  <!-- BEGIN Color profile -->
  <!-- this area is hidden and will not be seen on screens or screen readers -->
  <!-- we use this only for CSS color refernce for JS stuff -->
  <p id="js-color-profile" class="d-none">
    <span class="color-primary-50"></span>
    <span class="color-primary-100"></span>
    <span class="color-primary-200"></span>
    <span class="color-primary-300"></span>
    <span class="color-primary-400"></span>
    <span class="color-primary-500"></span>
    <span class="color-primary-600"></span>
    <span class="color-primary-700"></span>
    <span class="color-primary-800"></span>
    <span class="color-primary-900"></span>
    <span class="color-info-50"></span>
    <span class="color-info-100"></span>
    <span class="color-info-200"></span>
    <span class="color-info-300"></span>
    <span class="color-info-400"></span>
    <span class="color-info-500"></span>
    <span class="color-info-600"></span>
    <span class="color-info-700"></span>
    <span class="color-info-800"></span>
    <span class="color-info-900"></span>
    <span class="color-danger-50"></span>
    <span class="color-danger-100"></span>
    <span class="color-danger-200"></span>
    <span class="color-danger-300"></span>
    <span class="color-danger-400"></span>
    <span class="color-danger-500"></span>
    <span class="color-danger-600"></span>
    <span class="color-danger-700"></span>
    <span class="color-danger-800"></span>
    <span class="color-danger-900"></span>
    <span class="color-warning-50"></span>
    <span class="color-warning-100"></span>
    <span class="color-warning-200"></span>
    <span class="color-warning-300"></span>
    <span class="color-warning-400"></span>
    <span class="color-warning-500"></span>
    <span class="color-warning-600"></span>
    <span class="color-warning-700"></span>
    <span class="color-warning-800"></span>
    <span class="color-warning-900"></span>
    <span class="color-success-50"></span>
    <span class="color-success-100"></span>
    <span class="color-success-200"></span>
    <span class="color-success-300"></span>
    <span class="color-success-400"></span>
    <span class="color-success-500"></span>
    <span class="color-success-600"></span>
    <span class="color-success-700"></span>
    <span class="color-success-800"></span>
    <span class="color-success-900"></span>
    <span class="color-fusion-50"></span>
    <span class="color-fusion-100"></span>
    <span class="color-fusion-200"></span>
    <span class="color-fusion-300"></span>
    <span class="color-fusion-400"></span>
    <span class="color-fusion-500"></span>
    <span class="color-fusion-600"></span>
    <span class="color-fusion-700"></span>
    <span class="color-fusion-800"></span>
    <span class="color-fusion-900"></span>
  </p>
  <!-- END Color profile -->
  <!-- base vendor bundle:
  DOC: if you remove pace.js from core please note on Internet Explorer some CSS animations may execute before a page is fully loaded, resulting 'jump' animations
       + pace.js (recommended)
       + jquery.js (core)
       + jquery-ui-cust.js (core)
       + popper.js (core)
       + bootstrap.js (core)
       + slimscroll.js (extension)
       + app.navigation.js (core)
       + ba-throttle-debounce.js (core)
       + waves.js (extension)
       + smartpanels.js (extension)
       + src/../jquery-snippets.js (core) -->
  <script src="~/Scripts/vendors.bundle.js"></script>
  <script src="~/Scripts/app.bundle.js"></script>
  <script src="~/Scripts/formplugins/cropperjs/cropper.js"></script>
  <script>
    $(() => {
      let image = document.getElementById('upload_avatar_image');
      let avatarimg = document.getElementById('avatar_lg');

      let av = document.getElementById('upload_avatar_image');
      let $modal = $('.copper-modal-right');
      let cropper = null;
      $('.avatars > .overlay').click(function () {
        document.getElementById('upload_avatar').click();
      })
      $(document).on('show.bs.modal', '.modal', function (event) {
        var zIndex = 1040 + (10 * $('.modal:visible').length);
        $(this).css('z-index', zIndex);
        setTimeout(function () {
          $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');
        }, 0);
      });
      $modal.on('shown.bs.modal', function () {
        cropper = new Cropper(image, {
          aspectRatio: 1,
          viewMode: 1,
          preview: '.img-preview',
          width: 120,
          height: 120,
        });
      }).on('hidden.bs.modal', function () {
        cropper.destroy();
        cropper = null;
      });
      $('#upload_avatar').change(function (event) {
        var files = event.target.files;
        var done = function (url) {
          image.src = url;
          $modal.modal('toggle')
        };
        if (files && files.length > 0) {
          reader = new FileReader();
          reader.onload = function (event) {
            done(reader.result);
          };
          reader.readAsDataURL(files[0]);
        }
      });
      $('#getcoppedbutton').click(function () {

        const imageData = cropper.getImageData();
        const base64str = cropper.getCroppedCanvas().toDataURL();
        avatarimg.src = base64str;
         
        //console.log(imageData, canvasData)
      });
    })
    function getavatarbase64() {
      var canvas = document.createElement('canvas');
      var img = document.getElementById('avatar_lg');
      canvas.height = img.naturalHeight;
      canvas.width = img.naturalWidth;
      var ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      var base64String = canvas.toDataURL();
      return base64String;
    }
    $("#js-register-btn").click(function (event) {

      // Fetch form to apply custom Bootstrap validation
      var form = $("#js-register")

      if (form[0].checkValidity() === false) {
        event.preventDefault()
        event.stopPropagation()
      }

      form.addClass('was-validated');
      // Perform ajax submit here...
    });

  </script>
</body>
</html>
